 select special_id,play_sid from( select user_id,video_id,max(video_name) video_name,max(element_at(ext_info,'special_id')) special_id,max(element_at(ext_info,'special_name')) special_name,max(if(element_at(ext_info,'video_duration')='',0,cast(element_at(ext_info,'video_duration') as bigint))) video_duration,sp_id,play_sid,sum(if(event_type in ('buffer','pause','drag'),duration,0)) offtime,max(if(event_type='play',server_time,0)) playtime,max(if(event_type='finish',server_time,0)) finishtime from hive.xjcbc.play_log where day=20190123 and element_at(ext_info,'special_id') is not null and video_type ='vod' group by user_id,video_id,sp_id,play_sid) where special_id!='0000120' and special_name='????????? ?????????' group by special_id,play_sid;
